<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>What makes good taste of wine?</title>
    <style>
        div.bar {
            display: inline-block;
            width: 20px;
            height: 75px; /* We'll override height later */
            background-color: teal;
            margin-right: 2px;
        }

        div.container {
            display: inline-block;
            width: 320px;
            height: 575px;
            background-color: #e0e0e0;
            margin: 5px;
        }
    </style>
    <script type="text/javascript" src="d3/d3.js"></script>
</head>
<body>
<script type="text/javascript">
    var dataset;
    var file = "wine_white.csv";
    var linearScale = d3.scale.linear().domain([0, 10]).range([0, 200]);

    var data_keys = [];
    var dsv = d3.dsv(";", "text/plain");
    dsv(file, function (data) {
        dataset = data;    //Once loaded, copy to dataset.
        if (dataset.length > 0) {
            for (var prop in dataset[0]) {
                data_keys.push(prop);
            }
            generateVis();     //Then call other functions that
            //hideLoadingMsg();  //depend on data being present.
        }
    });
    function breakObjectIntoArray(datum) {
        var data_array = [];
        data_keys.forEach(function (prop) {
            data_array.push({data_key: prop, data_value: datum[prop]});
        });
        return data_array;
    }
    function generateVis() {
        d3.select("body").append("div").attr("id", "wrapper");

        var container = d3.select("#wrapper").selectAll("div")
                .data(dataset.sort(function (a, b) {
                    return b["quality"] - a["quality"]
                }).filter(function(d,i){
                    return i<50;
                }))
                .enter().append("div").attr("class", "container");

//        var p = container.selectAll("p").data(function (d) {
//            return breakObjectIntoArray(d);
//        }).enter().append("p").text(function (d) {
//            return d.data_key + ":" + d.data_value;
//        });

        var svg = container.append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        svg.selectAll("path")
                .data(function (d) {
                    var data_array = [];
                    data_keys.forEach(function (prop) {
                        if (prop == data_keys[data_keys.length - 1]) {
                            return;
                        }
                        data_array.push({data_key: prop, data_value: d[prop]});
                    });
                    return pie(data_array);
                })
                .enter().append("path")
                .style("fill", function (d, i) {
                    return color(i);
                })
                .attr("d", arc);

        container.append("p").text(function (d) {
            return d["quality"]
        });
//        container.sort(function (a, b) {
//            return b["quality"] - a["quality"]
//        });
    }

    var width = 300;
    var height = 300;
    var radius = height / 2 - 10;
    var color = d3.scale.category20();

    var arc = d3.svg.arc()
            .innerRadius(radius - 80)
            .outerRadius(radius);

    var pie = d3.layout.pie()
            .padAngle(.02).value(function (d) {
                return d.data_value;
            });
</script>
</body>
</html>
